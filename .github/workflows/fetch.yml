name: Update Deals Data

on:
  schedule:
    - cron: "0 */6 * * *"   # 每 6 小时
  workflow_dispatch:

permissions:
  contents: write

jobs:
  fetch:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Fetch milk deals
        run: |
          mkdir -p data
          curl -sG 'https://backflipp.wishabi.com/flipp/items/search' \
            --data-urlencode 'postal_code=M2N0M3' \
            --data-urlencode 'locale=en-CA' \
            --data-urlencode 'q=milk' \
            > data/milk.json

      - name: Commit
        run: |
          git config user.name "github-actions"
          git config user.email "actions@github.com"
          git add data/*.json
          git commit -m "update deals" || echo "no change"
          git push